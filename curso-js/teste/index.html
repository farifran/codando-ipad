<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Segurança de Entrada</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="xssProtection.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #2c3e50;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            margin-bottom: 2rem;
            color: #34495e;
            font-weight: 700;
            font-size: 2.25rem;
        }

        #formContainer {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: row;
            align-items: stretch;
            gap: 2rem;
        }

        form {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        form div {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #1a5276;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e3e4;
            border-radius: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            font-size: 1rem;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #1a5276;
            box-shadow: 0 0 0 3px rgba(26, 82, 118, 0.1);
        }

        button {
            padding: 0.75rem 1.5rem;
            background-color: #1a5276;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        button:hover {
            background-color: #154360;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .random-test-button {
            background-color: #2ecc71;
        }

        .random-test-button:hover {
            background-color: #27ae60;
        }

        #testList {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            max-height: 400px;
            display: block;
        }

        #testList thead {
            display: table-header-group;
        }

        #testList th,
        #testList td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #edeff1;
            font-size: 0.9rem;
            word-break: break-word;
        }

        #testList th {
            background-color: #f0f0f0;
            color: #2c3e50;
            font-weight: 600;
        }

        #testList tr:hover {
            background-color: #f5f5f5;
        }

        #results {
            margin-top: 0;
            padding: 1.5rem;
            background: #e3f2fd;
            border-radius: 6px;
            border: 1px solid #b0e0f5;
            color: #2c3e50;
            width: 100%;
            max-width: 400px;
            height: fit-content;
            word-wrap: break-word;
            opacity: 0;
            transition: opacity 0.3s ease, margin-top 0.3s ease;
            margin-top: -2rem;
        }

        #results.show {
            opacity: 1;
            margin-top: 0;
        }

        #results p {
            margin-bottom: 1rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        #results .changed {
            color: #e74c3c;
            font-style: italic;
            font-weight: 500;
        }

        .error {
            color: #e74c3c;
            font-size: 1rem;
            margin-top: 1rem;
            padding: 0.75rem;
            background: #fdedec;
            border: 1px solid #fadbd8;
            border-radius: 6px;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @media (max-width: 768px) {
            #formContainer {
                flex-direction: column;
            }

            #results {
                max-width: 100%;
                margin-top: 2rem;
            }
            #testList {
               display: block;
               overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.75rem;
            }

            #formContainer {
                padding: 1.5rem;
            }

            #testList th,
            #testList td {
                padding: 0.5rem;
                font-size: 0.8rem;
            }

            form div {
                margin-bottom: 1rem;
            }

            button {
                font-size: 1rem;
                padding: 0.75rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste de Segurança de Entrada</h1>
        <div id="formContainer">
            <form id="securityTestForm">
                <div>
                    <label for="textInput">Texto:</label>
                    <input type="text" name="textInput" id="textInput" placeholder="Insira um texto" aria-label="Entrada de texto" aria-describedby="textDesc">
                    <small id="textDesc">Insira um texto para sanitização</small>
                </div>
                <div>
                    <label for="numberInput">Número:</label>
                    <input type="text" name="numberInput" id="numberInput" placeholder="Insira um número" aria-label="Entrada de número" aria-describedby="textDesc">
                    <small id="numberDesc">Insira um número válido</small>
                </div>
                <div>
                    <label for="alphaInput">Alfanumérico:</label>
                    <input type="text" name="alphaInput" id="alphaInput" placeholder="Insira texto alfanumérico" aria-label="Entrada alfanumérica" aria-describedby="alphaDesc">
                    <small id="alphaDesc">Insira texto com letras e números</small>
                </div>
                <div>
                    <label for="urlInput">URL:</label>
                    <input type="text" name="urlInput" id="urlInput" placeholder="Insira uma URL" aria-label="Entrada de URL" aria-describedby="urlDesc">
                    <small id="urlDesc">Insira uma URL válida</small>
                </div>
                <div>
                    <button type="submit" aria-label="Testar entradas">Testar</button>
                    <button type="button" class="random-test-button" id="randomTestButton" aria-label="Gerar teste aleatório">Teste Aleatório</button>
                </div>
            </form>
            <div id="results">
                <h3>Resultado</h3>
            </div>
        </div>
        <h2>Lista de Teste:</h2>
        <table id="testList">
            <thead>
                <tr>
                    <th>Tipo de Entrada</th>
                    <th>Valor de Teste</th>
                    <th>Valor Esperado</th>
                    <th>Descrição</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Texto</td>
                    <td>&lt;script&gt;alert('XSS');&lt;/script&gt;</td>
                    <td>&amp;lt;script&amp;gt;alert('XSS');&amp;lt;/script&amp;gt;</td>
                    <td>XSS Attack</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>123abc456</td>
                    <td>123</td>
                    <td>Mistura de letras e números</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>abc123xyz!@#</td>
                    <td>abc123xyz</td>
                    <td>Caracteres especiais</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>javascript:alert('XSS')</td>
                    <td>#</td>
                    <td>Javascript como URL</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>https://www.google.com</td>
                    <td>https://www.google.com</td>
                    <td>URL válida</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>data:text/html,&lt;script&gt;alert('XSS')&lt;/script&gt;</td>
                    <td>#</td>
                    <td>Data URL XSS</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>" & ' &lt; &gt; `</td>
                    <td>&amp;quot; &amp;amp; &amp;#x27; &amp;lt; &amp;gt; &amp;#x60;</td>
                    <td>Entidades HTML</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>-12.5abc</td>
                    <td>-12.5</td>
                    <td>Número negativo com texto</td>
                </tr>
                <tr>
                    <td>Alfanumerico</td>
                    <td>teste123teste</td>
                    <td>teste123teste</td>
                    <td>Teste alfanumerico</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>  Testando espaço no começo e no final  </td>
                    <td>  Testando espaço no começo e no final  </td>
                    <td>Espaços inicial e final</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Quebra de linha\n dentro do texto</td>
                    <td>Quebra de linha\n dentro do texto</td>
                    <td>Quebra de linha</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Tabulação\t no texto</td>
                    <td>Tabulação\t no texto</td>
                    <td>Tabulação</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>1.2.3</td>
                    <td>1.2</td>
                    <td>Múltiplos pontos</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>1,234.56</td>
                    <td>1234.56</td>
                    <td>Vírgula como separador decimal</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>  TESTE123  </td>
                    <td>TESTE123</td>
                    <td>Espaços</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>Caracteres especiais na string !@#$%^&amp;*()</td>
                    <td>Caracteresespeciaisnastring</td>
                    <td>Caracteres especiais</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>http://example.com/path?param=value&amp;param2=value2</td>
                    <td>http://example.com/path?param=value&amp;param2=value2</td>
                    <td>URL com parâmetros</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>https://subdomain.example.com/</td>
                    <td>https://subdomain.example.com/</td>
                    <td>Subdomínio</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>ftp://ftp.example.com</td>
                    <td>ftp://ftp.example.com</td>
                    <td>Protocolo FTP</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>//example.com</td>
                    <td>//example.com</td>
                    <td>URL relativo</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>&lt;div style="position:absolute;left:0;top:0;width:100%;height:100%;background-color:white;"&gt;&lt;/div&gt;</td>
                    <td>&amp;lt;div style="position:absolute;left:0;top:0;width:100%;height:100%;background-color:white;"&amp;gt;&amp;lt;/div&amp;gt;</td>
                    <td>CSS Injection</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Teste com \"aspas\\"</td>
                    <td>Teste com "aspas"</td>
                    <td>Aspas escapadas</td>
                </tr>
                <tr>
                    <td>Texto</td>
                     <td>' or 1=1 -- </td>
                    <td>' or 1=1 -- </td>
                    <td>SQL Injection</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>1e10</td>
                    <td>1e10</td>
                    <td>Notação científica</td>
                </tr>
                 <tr>
                    <td>Número</td>
                    <td>0xFF</td>
                    <td>255</td>
                    <td>Valor hexadecimal</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>混合文字列123</td>
                    <td>123</td>
                    <td>String mista (caracteres latinos e não latinos)</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>https://www.example.com/search?q=test&amp;page=1</td>
                    <td>https://www.example.com/search?q=test&amp;page=1</td>
                    <td>URL com múltiplos parâmetros</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>/teste/teste</td>
                    <td>/teste/teste</td>
                    <td>Path Relativo</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>&lt;TABLE BORDER=1&gt;&lt;TR&gt;&lt;TD&gt;Test&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;</td>
                    <td>&amp;lt;TABLE BORDER=1&amp;gt;&amp;lt;TR&amp;gt;&amp;lt;TD&amp;gt;Test&amp;lt;/TD&amp;gt;&amp;lt;/TR&amp;gt;&amp;lt;/TABLE&amp;gt;</td>
                    <td>HTML Injection</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Testando formatação de texto &lt;b&gt;negrito&lt;/b&gt; e &lt;i&gt;itálico&lt;/i&gt;</td>
                    <td>Testando formatação de texto &amp;lt;b&amp;gt;negrito&amp;lt;/b&amp;gt; e &lt;i&amp;gt;itálico&lt;/i&amp;gt;</td>
                    <td>Formatação de texto</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Teste de quebra de linha com br &lt;br&gt;</td>
                    <td>Teste de quebra de linha com br &amp;lt;br&amp;gt;</td>
                    <td>Quebra de linha com BR</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>100000000000000000000</td>
                    <td>100000000000000000000</td>
                    <td>Número muito grande</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>-100000000000000000000</td>
                    <td>-100000000000000000000</td>
                    <td>Número negativo muito grande</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</td>
                    <td>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</td>
                    <td>String alfanumérica completa</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>Teste com caracteres acentuados áéíóúçãõ</td>
                    <td>Testecomcaracteresacentuadosaeioucao</td>
                    <td>Caracteres acentuados</td>
                </tr>
                 <tr>
                    <td>URL</td>
                    <td>https://www.example.com/verylongpath/verylongpath/verylongpath/verylongpath/verylongpath/index.html</td>
                    <td>https://www.example.com/verylongpath/verylongpath/verylongpath/verylongpath/verylongpath/index.html</td>
                    <td>URL muito longa</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>https://www.example.com#fragment</td>
                    <td>https://www.example.com#fragment</td>
                    <td>URL com fragmento</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Teste com emoji 😃👍</td>
                    <td>Teste com emoji 😃👍</td>
                    <td>Teste com emoji</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Teste com caractere unicode 𝔄</td>
                    <td>Teste com caractere unicode 𝔄</td>
                    <td>Teste com caractere unicode</td>
                </tr>
                <tr>
                    <td>Texto</td>
                    <td>Teste de texto com múltiplas linhas\n\n\n</td>
                    <td>Teste de texto com múltiplas linhas\n\n\n</td>
                    <td>Múltiplas linhas</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>+12345</td>
                    <td>12345</td>
                    <td>Número com sinal positivo</td>
                </tr>
                <tr>
                    <td>Número</td>
                    <td>1,000,000.00</td>
                    <td>1000000.00</td>
                    <td>Número com separador de milhar e decimal</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</td>
                    <td>1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</td>
                    <td>Todos os caracteres alfanuméricos</td>
                </tr>
                <tr>
                    <td>Alfanumérico</td>
                    <td>テスト123テスト</td>
                    <td>123</td>
                    <td>String com caracteres japoneses</td>
                </tr>
                <tr>
                    <td>URL</td>
                    <td>https://user:password@www.example.com</td>
                    <td>https://user:password@www.example.com</td>
                    <td>URL com autenticação</td>
                </tr>
                <tr>
                    <td>URL</td>
                  <td>https://www.example.com:8080</td>
                  <td>https://www.example.com:8080</td>
                  <td>URL com porta</td>
                </tr>
            </tbody>
        </table>
    </div>
    <script>
       function getChanges(original, sanitized) {
            return original !== sanitized ? `<span class="changed"> ${escapeHTML(original)}</span>` : '';
        }

        function getTestData() {
            const data = [];
            const rows = document.querySelectorAll('#testList tr'); //lista que podemos
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].querySelectorAll('td');
                if (cells.length === 4) {
                    data.push({
                        type: cells[0].textContent.trim(),
                        value: cells[1].textContent.trim(),
                        expected: cells[2].textContent.trim(),
                        description: cells[3].textContent.trim()
                    });
                }
            }
            return data;
        }

        function compareWithExpected(type, result, testData) {
            const test = testData.find(t => t.type === type && t.value === result.original);
            if (test) {
                return comparison = result.sanitized === test.expected ? '✅ Sucesso' : `❌ Valor experado: ${test.expected}`;
    }
            return '';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('#securityTestForm');
            const resultsDiv = document.querySelector('#results');
            const textInput = form.querySelector('#textInput');
            const numberInput = form.querySelector('#numberInput');
            const alphaInput = form.querySelector('#alphaInput');
            const urlInput = form.querySelector('#urlInput');
            const randomTestButton = document.querySelector('#randomTestButton');
            const testData = getTestData();

            form.addEventListener('submit', (event) => {
                event.preventDefault();
                try {
                    const textVal = textInput.value;
                    const numberVal = numberInput.value;
                    const alphaVal = alphaInput.value;
                    const urlVal = urlInput.value;

                    const textResult = { original: textVal, sanitized: escapeHTML(sanitizeInput(textVal)) };
                    const numberResult = { original: numberVal, sanitized: String(sanitizeInput(numberVal, 'number')) };
                    const alphaResult = { original: alphaVal, sanitized: String(sanitizeInput(alphaVal))};
                    const urlResult = { original: urlVal, sanitized: sanitizeURL(urlVal) };

                    resultsDiv.innerHTML = `
                        <h3>Resultado</h3>
                        <p><strong>Texto obtido:</strong> ${textResult.sanitized}<br>${compareWithExpected('Texto', textResult, testData)}</p>
                        <p><strong>Número Obtido:</strong> ${numberResult.sanitized}<br>${compareWithExpected('Número', numberResult, testData)}</p>
                        <p><strong>Alfanumérico Obtido:</strong> ${alphaResult.sanitized}<br>${compareWithExpected('Alfanumérico', alphaResult, testData)}</p>
                        <p><strong>URL Obtida:</strong> ${urlResult.sanitized}<br>${compareWithExpected('URL', urlResult, testData)}</p>
                    `;
                    resultsDiv.classList.add('show');
                } catch (e) {
                    resultsDiv.innerHTML = `<p class="error">Erro: ${e.message}</p>`;
                    resultsDiv.classList.remove('show');
                }
            });

            randomTestButton.addEventListener('click', () => {
                const randomIndex = Math.floor(Math.random() * testData.length);
                const test = testData[randomIndex];
                textInput.value = test.type === 'Texto' ? test.value : '';
                numberInput.value = test.type === 'Número' ? test.value : '';
                alphaInput.value = test.type === 'Alfanumérico' ? test.value : '';
                urlInput.value = test.type === 'URL' ? test.value : '';
                form.requestSubmit();
            });
        });
    </script>
</body>
</html>